---
import Layout from "../layouts/Layout.astro";
import LoginForm from "../components/LoginForm.astro";
import hasProfile from "../utils/profile";

const cookie: string = `${Astro.cookies.get(import.meta.env.COOKIE_NAME || "_Security_Login_")?.value}`;
const d = hasProfile(cookie, import.meta.env.COOKIE_SECRET || "secret");

if (d.success === true) {
    return Astro.redirect("/");
}

const error = new URL(Astro.request.url).searchParams.get("error");
---

<Layout title="login">
    <main>
        <div class="absolute inset-0 -z-10 overflow-hidden">
            <svg class="absolute top-0 w-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                <path fill="#4f46e5" fill-opacity="0.2" d="M0,96L30,106.7C60,117,120,139,180,154.7C240,171,300,181,360,160C420,139,480,85,540,64C600,43,660,53,720,96C780,139,840,213,900,213.3C960,213,1020,139,1080,96C1140,53,1200,43,1260,74.7C1320,107,1380,181,1410,218.7L1440,256L1440,0L1410,0C1380,0,1320,0,1260,0C1200,0,1140,0,1080,0C1020,0,960,0,900,0C840,0,780,0,720,0C660,0,600,0,540,0C480,0,420,0,360,0C300,0,240,0,180,0C120,0,60,0,30,0L0,0Z"></path>
            </svg>
            <svg class="absolute bottom-0 w-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                <path fill="#4f46e5" fill-opacity="0.2" d="M0,224L30,202.7C60,181,120,139,180,133.3C240,128,300,160,360,192C420,224,480,256,540,234.7C600,213,660,139,720,128C780,117,840,171,900,181.3C960,192,1020,160,1080,144C1140,128,1200,128,1260,149.3C1320,171,1380,213,1410,234.7L1440,256L1440,320L1410,320C1380,320,1320,320,1260,320C1200,320,1140,320,1080,320C1020,320,960,320,900,320C840,320,780,320,720,320C660,320,600,320,540,320C480,320,420,320,360,320C300,320,240,320,180,320C120,320,60,320,30,320L0,320Z"></path>
            </svg>
        </div>
        <div
                class={`min-h-screen flex items-center justify-center ${
                  error === "true" ? "error-active" : ""
                }`}
        >
          {/* Error Message */}
          {error === "true" && (
                  <div class="absolute top-4 w-full max-w-md mx-auto bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded">
                      <p>Error: Could not login. Please verify your credentials.</p>
                  </div>
          )}

          {/* Login Container */}
            <div class="w-full max-w-md p-6 ">
                <LoginForm />
            </div>
        </div>
    </main>
</Layout>

<style>
    main {
        margin: auto;
        padding: 1rem;
        //width: 800px;
        max-width: calc(100% - 2rem);
        color: white;
        font-size: 20px;
        line-height: 1.6;
    }
</style>